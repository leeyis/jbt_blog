(function(){var a=function(b){"use strict";function c(a){if(a.paused||a.ended||s)return!1;try{m.clearRect(0,0,k,j),m.drawImage(a,0,0,k,j)}catch(a){}v=setTimeout(function(){c(a)},K.duration),J.setIcon(l)}function d(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,c,d,e){return c+c+d+d+e+e});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return!!c&&{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}}function e(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}function f(){return w.hidden||w.msHidden||w.webkitHidden||w.mozHidden}b=b?b:{};var g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1,element:null,dataUrl:!1,win:window};t={},t.ff="undefined"!=typeof InstallTrigger,t.chrome=!!window.chrome,t.opera=!!window.opera||0<=navigator.userAgent.indexOf("Opera"),t.ie=!1,t.safari=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),t.supported=t.chrome||t.ff||t.opera;var y=[];r=function(){},o=s=!1;var z=function(){g=e(x,b),g.bgColor=d(g.bgColor),g.textColor=d(g.textColor),g.position=g.position.toLowerCase(),g.animation=K.types[""+g.animation]?g.animation:x.animation,w=g.win.document;var c=-1<g.position.indexOf("up"),f=-1<g.position.indexOf("left");if(c||f)for(var o in K.types)for(var a,p=0;p<K.types[o].length;p++)a=K.types[o][p],c&&(.6>a.y?a.y-=.4:a.y=a.y-2*a.y+(1-a.w)),f&&(.6>a.x?a.x-=.4:a.x=a.x-2*a.x+(1-a.h)),K.types[o][p]=a;g.type=B[""+g.type]?g.type:x.type,h=J.getIcons(),l=document.createElement("canvas"),n=document.createElement("img");var q=h[h.length-1];q.hasAttribute("href")?(n.setAttribute("crossOrigin","anonymous"),n.onload=function(){j=0<n.height?n.height:32,k=0<n.width?n.width:32,l.height=j,l.width=k,m=l.getContext("2d"),A.ready()},n.setAttribute("src",q.getAttribute("href"))):(j=32,k=32,n.height=j,n.width=k,l.height=j,l.width=k,m=l.getContext("2d"),A.ready())},A={};A.ready=function(){o=!0,A.reset(),r()},A.reset=function(){o&&(y=[],p=!1,q=!1,m.clearRect(0,0,k,j),m.drawImage(n,0,0,k,j),J.setIcon(l),window.clearTimeout(u),window.clearTimeout(v))},A.start=function(){if(o&&!q){var a=function(){p=y[0],q=!1,0<y.length&&(y.shift(),A.start())};if(0<y.length){q=!0;var b=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach(function(b){b in y[0].options&&(g[b]=y[0].options[b])}),K.run(y[0].options,function(){a()},!1)};p?K.run(p.options,function(){b()},!0):b()}}};var B={},C=function(a){return a.n="number"==typeof a.n?Math.abs(0|a.n):a.n,a.x=k*a.x,a.y=j*a.y,a.w=k*a.w,a.h=j*a.h,a.len=(""+a.n).length,a};B.circle=function(a){a=C(a);var b=!1;2===a.len?(a.x-=.4*a.w,a.w*=1.4,b=!0):3<=a.len&&(a.x-=.65*a.w,a.w*=1.65,b=!0),a.w=14,a.h=14,a.x=k-a.w,a.y=j-a.h,m.clearRect(0,0,k,j),m.drawImage(n,0,0,k,j),m.beginPath(),m.font=g.fontStyle+" "+Math.floor(a.h*(99<a.n?.85:1))+"px "+g.fontFamily,m.textAlign="center",b?(m.moveTo(a.x+a.w/2,a.y),m.lineTo(a.x+a.w-a.h/2,a.y),m.quadraticCurveTo(a.x+a.w,a.y,a.x+a.w,a.y+a.h/2),m.lineTo(a.x+a.w,a.y+a.h-a.h/2),m.quadraticCurveTo(a.x+a.w,a.y+a.h,a.x+a.w-a.h/2,a.y+a.h),m.lineTo(a.x+a.h/2,a.y+a.h),m.quadraticCurveTo(a.x,a.y+a.h,a.x,a.y+a.h-a.h/2),m.lineTo(a.x,a.y+a.h/2),m.quadraticCurveTo(a.x,a.y,a.x+a.h/2,a.y)):m.arc(a.x+a.w/2,a.y+a.h/2,a.h/2,0,2*Math.PI),m.fillStyle="rgba("+g.bgColor.r+","+g.bgColor.g+","+g.bgColor.b+","+a.o+")",m.fill(),m.closePath(),m.beginPath(),m.stroke(),m.fillStyle="rgba("+g.textColor.r+","+g.textColor.g+","+g.textColor.b+","+a.o+")","number"==typeof a.n&&999<a.n?m.fillText((9999<a.n?9:Math.floor(a.n/1e3))+"k+",Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.2*a.h)):m.fillText(a.n,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.15*a.h)),m.closePath()},B.rectangle=function(a){a=C(a);var b=!1;2===a.len?(a.x-=.4*a.w,a.w*=1.4,b=!0):3<=a.len&&(a.x-=.65*a.w,a.w*=1.65,b=!0),m.clearRect(0,0,k,j),m.drawImage(n,0,0,k,j),m.beginPath(),m.font=g.fontStyle+" "+Math.floor(a.h*(99<a.n?.9:1))+"px "+g.fontFamily,m.textAlign="center",m.fillStyle="rgba("+g.bgColor.r+","+g.bgColor.g+","+g.bgColor.b+","+a.o+")",m.fillRect(a.x,a.y,a.w,a.h),m.fillStyle="rgba("+g.textColor.r+","+g.textColor.g+","+g.textColor.b+","+a.o+")","number"==typeof a.n&&999<a.n?m.fillText((9999<a.n?9:Math.floor(a.n/1e3))+"k+",Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.2*a.h)):m.fillText(a.n,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.15*a.h)),m.closePath()};var D=function(a,b){b=("string"==typeof b?{animation:b}:b)||{},r=function(){try{if("number"==typeof a?0<a:""!==a){var c={type:"badge",options:{n:a}};if("animation"in b&&K.types[""+b.animation]&&(c.options.animation=""+b.animation),"type"in b&&B[""+b.type]&&(c.options.type=""+b.type),["bgColor","textColor"].forEach(function(a){a in b&&(c.options[a]=d(b[a]))}),["fontStyle","fontFamily"].forEach(function(a){a in b&&(c.options[a]=b[a])}),y.push(c),100<y.length)throw new Error("Too many badges requests in queue.");A.start()}else A.reset()}catch(a){throw new Error("Error setting badge. Message: "+a.message)}},o&&r()},E=function(a){r=function(){try{var b=a.width,c=a.height,d=document.createElement("img"),e=b/k<c/j?b/k:c/j;d.setAttribute("crossOrigin","anonymous"),d.onload=function(){m.clearRect(0,0,k,j),m.drawImage(d,0,0,k,j),J.setIcon(l)},d.setAttribute("src",a.getAttribute("src")),d.height=c/e,d.width=b/e}catch(a){throw new Error("Error setting image. Message: "+a.message)}},o&&r()},F=function(a){r=function(){J.setIconSrc(a)},o&&r()},G=function(a){r=function(){try{if("stop"===a)return s=!0,A.reset(),void(s=!1);a.addEventListener("play",function(){c(this)},!1)}catch(a){throw new Error("Error setting video. Message: "+a.message)}},o&&r()},H=function(a){if(window.URL&&window.URL.createObjectURL||(window.URL=window.URL||{},window.URL.createObjectURL=function(a){return a}),t.supported){var b=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,r=function(){try{if("stop"===a)return s=!0,A.reset(),void(s=!1);b=document.createElement("video"),b.width=k,b.height=j,navigator.getUserMedia({video:!0,audio:!1},function(a){b.src=URL.createObjectURL(a),b.play(),c(b)},function(){})}catch(a){throw new Error("Error setting webcam. Message: "+a.message)}},o&&r()}},I=function(a,b){var c=a;null==b&&"[object Object]"==Object.prototype.toString.call(a)||(c={},c[a]=b);for(var e=Object.keys(c),f=0;f<e.length;f++)g[e[f]]="bgColor"==e[f]||"textColor"==e[f]?d(c[e[f]]):c[e[f]];y.push(p),A.start()},J={};J.getIcons=function(){var a=[],b=function(){for(var a=[],b=w.getElementsByTagName("head")[0].getElementsByTagName("link"),c=0;c<b.length;c++)/(^|\s)icon(\s|$)/i.test(b[c].getAttribute("rel"))&&a.push(b[c]);return a};return g.element?a=[g.element]:g.elementId?(a=[w.getElementById(g.elementId)],a[0].setAttribute("href",a[0].getAttribute("src"))):(a=b(),0===a.length&&(a=[w.createElement("link")],a[0].setAttribute("rel","icon"),w.getElementsByTagName("head")[0].appendChild(a[0]))),a.forEach(function(a){a.setAttribute("type","image/png")}),a},J.setIcon=function(a){var b=a.toDataURL("image/png");J.setIconSrc(b)},J.setIconSrc=function(a){if(g.dataUrl&&g.dataUrl(a),g.element)g.element.setAttribute("href",a),g.element.setAttribute("src",a);else if(g.elementId){var b=w.getElementById(g.elementId);b.setAttribute("href",a),b.setAttribute("src",a)}else if(t.ff||t.opera){var c=h[h.length-1],d=w.createElement("link");h=[d],t.opera&&d.setAttribute("rel","icon"),d.setAttribute("rel","icon"),d.setAttribute("type","image/png"),w.getElementsByTagName("head")[0].appendChild(d),d.setAttribute("href",a),c.parentNode&&c.parentNode.removeChild(c)}else h.forEach(function(b){b.setAttribute("href",a)})};var K={};return K.duration=40,K.types={},K.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],K.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],K.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],K.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],K.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],K.run=function(a,b,c,d){var h=K.types[f()?"none":g.animation];return d=!0===c?"undefined"==typeof d?h.length-1:d:"undefined"==typeof d?0:d,b=b?b:function(){},d<h.length&&0<=d?void(B[g.type](e(a,h[d])),u=setTimeout(function(){c?--d:++d,K.run(a,b,c,d)},K.duration),J.setIcon(l)):void b()},z(),{badge:D,video:G,image:E,rawImageSrc:F,webcam:H,setOpt:I,reset:A.reset,browser:{supported:t.supported}}};"undefined"!=typeof define&&define.amd?define([],function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:this.Favico=a})();
